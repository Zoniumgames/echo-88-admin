<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel Admin - Echo88</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
    }
    textarea, input, button {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.6rem;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
    }
    textarea {
      height: 150px;
    }
    button {
      background: #e20074;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    h2 {
      color: #e20074;
    }
  </style>
</head>
<body>
  <h2>Panel de Administraci√≥n</h2>
  <label>Mensaje de Aviso:</label>
  <input type="text" id="aviso">

  <label>Canciones Nuevas (una por l√≠nea):</label>
  <textarea id="canciones"></textarea>
<label>
  <input type="checkbox" id="mostrarCaja"> Mostrar recuadro lateral
</label>

  <button onclick="guardarDatos()">üíæ Guardar cambios</button>

  <p id="estado"></p>

<hr style="margin: 2rem 0; border-color: #444;">
<h2>Usuarios Activos</h2>
<ul id="user-list" style="list-style: none; padding: 0;"></ul>

  <script>
    const BIN_ID = '684ce02a8561e97a5023f0e8'; // Solo el ID, no la URL completa
    const API_KEY = '$2a$10$rOYhULeCIqQqevfSQljVuuaE8F1ckttBnNVRqRJ7sdT4IS8.J.zF.'; // Tu clave secreta

    const url = `https://api.jsonbin.io/v3/b/${BIN_ID}`;
    const headers = {
      'X-Master-Key': API_KEY,
      'Content-Type': 'application/json'
    };

    // Cargar datos existentes
    // Cargar datos existentes
async function cargarDatos() {
  try {
    const res = await fetch(url + '/latest', { headers });
    const data = await res.json();

    document.getElementById('aviso').value = data.record.aviso;
    document.getElementById('canciones').value = data.record.nuevasCanciones.join('\n');

    // ‚úÖ Aqu√≠ est√° el FIX: marcar el checkbox correctamente
    const mostrarCaja = data.record.mostrarCaja !== false; // si es false ‚Üí desmarcar
    document.getElementById('mostrarCaja').checked = mostrarCaja;
  } catch (err) {
    document.getElementById('estado').textContent = 'Error cargando datos: ' + err.message;
  }
}

    // Guardar cambios
    // Guardar cambios
async function guardarDatos() {
  const aviso = document.getElementById('aviso').value.trim();
  const canciones = document.getElementById('canciones').value.trim().split('\n').map(c => c.trim());
  const mostrarCaja = document.getElementById('mostrarCaja').checked;

  const cuerpo = {
    aviso,
    nuevasCanciones: canciones,
    mostrarCaja
  };

  try {
    const res = await fetch(url, {
      method: 'PUT',
      headers,
      body: JSON.stringify(cuerpo)
    });

    if (res.ok) {
      document.getElementById('estado').textContent = '‚úÖ Cambios guardados correctamente';
    } else {
      throw new Error(await res.text());
    }
  } catch (err) {
    document.getElementById('estado').textContent = '‚ùå Error al guardar: ' + err.message;
  }
}

    cargarDatos();
  </script>
<script>
const BIN_ID_USUARIOS = '684de23a8960c979a5a9f92b'; // ID del bin que contiene los usuarios
const urlUsuarios = `https://api.jsonbin.io/v3/b/${BIN_ID_USUARIOS}`;

async function cargarUsuarios() {
  try {
    const res = await fetch(urlUsuarios + '/latest', { headers });
    const data = await res.json();
    const usuarios = data.record.usuarios;

    const lista = document.getElementById('user-list');
    lista.innerHTML = ''; // Limpiar la lista

    usuarios.forEach((u, i) => {
      const li = document.createElement('li');
      li.style.marginBottom = '1rem';

      li.innerHTML = `
        <strong>${u.usuario}</strong><br>
        Estado: <span style="color:${u.activo ? 'limegreen' : 'gray'};">
          ${u.activo ? 'Activo üü¢' : 'Inactivo ‚ö™'}
        </span>
        ${u.activo ? `<br><button onclick="forzarLogout(${i})" style="margin-top:0.5rem;">üîì Desconectar</button>` : ''}
      `;

      lista.appendChild(li);
    });
  } catch (err) {
    document.getElementById('estado').textContent = '‚ùå Error cargando usuarios: ' + err.message;
  }
}

async function forzarLogout(index) {
  if (!confirm("¬øCerrar la sesi√≥n de este usuario?")) return;

  try {
    const res = await fetch(urlUsuarios + '/latest', { headers });
    const data = await res.json();
    const usuarios = data.record.usuarios;

    if (usuarios[index]) {
      usuarios[index].activo = false;

      await fetch(urlUsuarios, {
        method: 'PUT',
        headers,
        body: JSON.stringify({ ...data.record, usuarios })
      });

      alert('‚úÖ Usuario desconectado correctamente.');
      cargarUsuarios(); // recargar lista
    }
  } catch (err) {
    alert('‚ùå Error al desconectar usuario: ' + err.message);
  }
}

// Ejecutar al cargar el panel
cargarUsuarios();
</script>
</body>
</html>